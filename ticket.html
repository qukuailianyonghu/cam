<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hack Demo</title>
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no, email=no" />
    <!--[if IE]>
    <script src="js/html5shiv.min.js"></script>
    <![endif]-->

    <style>
        .loader {
          border: 12px solid #444;
          border-radius: 50%;
          border-top: 5px solid blue;
          border-right: 5px solid green;
          border-bottom: 5px solid red;
          border-left: 5px solid pink;
          width: 60px;
          height: 60px;
          -webkit-animation: spin 2s linear infinite;
          animation: spin 2s linear infinite;
        }
        
        @-webkit-keyframes spin {
          0% { -webkit-transform: rotate(0deg); }
          100% { -webkit-transform: rotate(360deg); }
        }
        
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

    .tms-load-box{
        display:inline-block;
        border:#A1C5F7;
        padding: 13px 20px;
        /* background:#260354; */
        background-image: 'images/logo_n.png';
        position:fixed;
        z-index:999999;
        color:#545454;
        left:59%;
        top:45%;
        margin-left:-90px;
        margin-top:-30px;
    }
    .tms-load-box img{
        margin-right:10px;
    }
    .tms-load-mask{
        height:100%;
        width:100%;
        position:fixed;
        z-index:99999;
        left:0;
        top:0;
        background: #545454;
        opacity: 0.50;
        filter: alpha(opacity=50);
        }

</style>
</head>
<body>
<header>
    <img src="images/logo.png" style="width: 7rem;" id="home"/>
    <img src="images/search.png"/>
    
    <img src="images/person.png" style="float: right; margin-right: 1rem;"/>
    <img src="images/doing.png" style="float: right;"/>
    <img src="images/sell.png" style="float: right;"/>

    <div class="clear"></div>
</header>

<div id='tms-comm-load' hidden>
    <div class='tms-load-box'>
        <div class="loader"></div>
    </div>
</div>

<section class="logo-license">
        <img src="./images/middle.png" style="width: 100%;">
    <div>
        <br/><br/><br/><br/><br/><br/><br/><br/>
        <div class="uploader blue" style="height: 80%;">
            <input hidden type="text" class="filename" readonly/>
            <a class="license">
                <img id="img-1" src="images/logo_n.png"/>
            </a>
            <form enctype="multipart/form-data" id="uploadForm">
                <input id="file0" class="file-3" name="file" type="file" accept="image/*"/>
            </form>
        </div>
        <div class="yulan">
            <img src="" id="img0" >
            <div class="enter">
                    <button class="btn-2 fl">Cancle</button>
                    <button class="btn-3 fr">Confirm</button>
                </div>
        </div>

    </div>
    <div class="clear"></div>
</section>

<br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/>
<article class="btn-1">
    <button>Upload Ticket</button>
</article>

<article class="info" hidden>
        <ul>
            <li>
                <div class="left">
                 EventId:
                </div>
                <div class="right">
                  <input id="EventId" placeholder="103770834">
                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="left">
                    Section:
                </div>
                <div class="right">
                    <input id="Section" placeholder="115">
                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="left">
                    Row:
                </div>
                <div class="right">
                    <input id="Row" placeholder="M">
                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="left">
                    Seat:
                </div>
                <div class="right">
                    <input id="Seat" placeholder="2">
                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="left">
                    Auto-Pricing:
                </div>
                <div class="right">
                    <input id="Auto-Pricing" placeholder="$115">
                </div>
                <div class="clear"></div>
            </li>
        </ul>
    </article>

<script src="js/jquery.min.js" type="text/javascript"></script>
<script>window.jQuery || document.write('<script src="js/jquery-2.1.1.min.js"><\/script>')</script>
<script src="js/iscroll-zoom.js"></script>
<script src="js/hammer.js"></script>
<script src="js/jquery.photoClip.js"></script>
<script>

function upload(){
    if($('#file0').val() == ''){
        alert("please choice picture!");
    }else{
        $("#tms-comm-load").show();
        let form = document.getElementById('uploadForm')
        let formData = new FormData(form) 
        formData.append("name","lisi");

        for (var key of formData.entries()) {
            console.log(key[0] + ', ' + key[1]);
        }
        $.ajax({
        url: 'https://hack2019-uoltrlruwa-uc.a.run.app/ocr',
        cache: false,
        contentType: false,
        processData: false,
        data: formData,
        type: 'POST',
        headers: {
                 "Authorization":"Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsiYXBpOi8vc3R1Ymh1YiJdLCJzdWIiOiJGb0Y3UlZQTmFYQjFKMl9uY3ZodTB0eHQxZkVhIiwic2NvcGUiOlsiZGVmYXVsdCIsIm1scF9tb2RlbF9tZ210IiwibWxwX21vbml0b3JpbmciLCJtbHBfZmVhdHVyZV9zdG9yZSIsIm9wZW5pZCIsImF1dG9fcHJpY2luZyIsIm1scF9zZWN1cml0eSIsIm1scF9taW5pX2FwcCJdLCJpc3MiOiJodHRwczovL2FwYy5zdHViaHViLmNvbS9pZGVudGl0eS9vYXV0aCIsImV4cCI6MTU4OTAxNTYzOCwiaWF0IjoxNTczNDYzNjM4LCJqdGkiOiI4Nzg0Y2QwZC03YzI2LTQ0M2YtYjA4Yy01NjRhNjVhYjE4M2QiLCJjbGllbnRfaWQiOiJGb0Y3UlZQTmFYQjFKMl9uY3ZodTB0eHQxZkVhIn0.HsNeMd0vJcHHC5iOJTGYCxqs-UQ2AfT0V2e6o-KVqnwdYf3l6udz7x_aHLM_TuE5523DbRVrmyXantgjoK-RnRdt6wGiZ1AHUaj0FT7zh0iTZuoc5CpQB110beoNNH6loivJ-KREe7kBd-MvL3hLwHLfJZSeu2KK3j6hUDfZStBGtqEdrE0UoBHqtdMvih0IfYXgm5wdYCJ6jNxev251CNxVt85XCZa20KGNYRKPR-waKvEfQrYct89uvyUI-4Z13s0p4BtvLuEkEwzMuCwVKSOYK0h2C--Yzyhe1aEC6XVKYQqnw8lHse24cukyBPYxfxHgAw7qRtK0XJNE9J4MOQ",
            },
        success: function(response) {
            console.log(response);
            console.log(response['auto_pricing']);
            var eventId = '103770834';
            var section = response['section'];
            var row = response['row'];
            var seat = response['seat'];
            var auto_pricing = response['auto_pricing'];

            var surl = $('#img0').attr('src');
            direct(eventId,section,row,seat,auto_pricing,surl);
        },
        error: function(error) {
            console.log(error);
        }
    });
    }
}

function direct(eventId,section,row,seat,auto_pricing,surl) {
        window.location.href='result.html?eventId=' + eventId + '&section=' + section
        + "&row=" + row + "&seat=" + seat + "&auto_pricing=" + auto_pricing + "&suburl=" + surl;
    }
    
    $("#clipArea").photoClip({
        width: 199,
        height: 166,
        file: "#file",
        view: "#view",
        ok: "#clipBtn",
        loadStart: function() {
            console.log("reading picture");
        },
        loadComplete: function() {
            console.log("reading finished");
        },
        clipFinish: function(dataURL) {
            console.log(dataURL);
        }
    });
</script>
<script>
$(function(){
    $("#home").click(function(){
        window.location.href='index.html';
    });

    $("#logox").click(function(){
        $(".htmleaf-container").show();
    })
        $("#clipBtn").click(function(){
            $("#logox").empty();
            $('#logox').append('<img src="' + imgsource + '" align="absmiddle" style=" width: 5rem;height: 4.16rem; margin-left: 1.5rem;margin-top: 1.92rem">');
            $(".htmleaf-container").hide();
        })
    });
</script>
<script type="text/javascript">
    $(function(){
        jQuery.divselect = function(divselectid,inputselectid) {
            var inputselect = $(inputselectid);
            $(divselectid+" small").click(function(){
                $("#divselect ul").toggle();
                $(".mask").show();
            });
            $(divselectid+" ul li a").click(function(){
                var txt = $(this).text();
                $(divselectid+" small").html(txt);
                var value = $(this).attr("selectid");
                inputselect.val(value);
                $(divselectid+" ul").hide();
                $(".mask").hide();
                $("#divselect small").css("color","#333")
            });
        };
        $.divselect("#divselect","#inputselect");
    });
</script>
<script type="text/javascript">
    $(function(){
        jQuery.divselectx = function(divselectxid,inputselectxid) {
            var inputselectx = $(inputselectxid);
            $(divselectxid+" small").click(function(){
                $("#divselectx ul").toggle();
                $(".mask").show();
            });
            $(divselectxid+" ul li a").click(function(){
                var txt = $(this).text();
                $(divselectxid+" small").html(txt);
                var value = $(this).attr("selectidx");
                inputselectx.val(value);
                $(divselectxid+" ul").hide();
                $(".mask").hide();
                $("#divselectx small").css("color","#333")
            });
        };
        $.divselectx("#divselectx","#inputselectx");
    });
</script>
<script type="text/javascript">
    $(function(){
        jQuery.divselecty = function(divselectyid,inputselectyid) {
            var inputselecty = $(inputselectyid);
            $(divselectyid+" small").click(function(){
                $("#divselecty ul").toggle();
                $(".mask").show();
            });
            $(divselectyid+" ul li a").click(function(){
                var txt = $(this).text();
                $(divselectyid+" small").html(txt);
                var value = $(this).attr("selectyid");
                inputselecty.val(value);
                $(divselectyid+" ul").hide();
                $(".mask").hide();
                $("#divselecty small").css("color","#333")
            });
        };
        $.divselecty("#divselecty","#inputselecty");
    });
</script>
<script type="text/javascript">
    $(function(){
       $(".mask").click(function(){
           $(".mask").hide();
           $(".all").hide();
       })
        $(".right input").blur(function () {
            if ($.trim($(this).val()) == '') {
                $(this).addClass("place").html();
            }
            else {
                $(this).removeClass("place");
            }
        })
    });
</script>
<script>
    var obUrl = ''
    $("#file0").change(function(){
        var objUrl = getObjectURL(this.files[0]) ;
         obUrl = objUrl;
        console.log("objUrl = "+objUrl) ;
        if (objUrl) {
            $("#img0").attr("src", objUrl).show();
        }
        else{
            $("#img0").hide();
        }
    }) ;
   function qd(){
       var objUrl = getObjectURL(this.files[0]) ;
       obUrl = objUrl;
       console.log("objUrl = "+objUrl) ;
       if (objUrl) {
           $("#img0").attr("src", objUrl).show();
       }
       else{
           $("#img0").hide();
       }
   }
    function getObjectURL(file) {
        var url = null ;
        if (window.createObjectURL!=undefined) { // basic
            url = window.createObjectURL(file) ;
        } else if (window.URL!=undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file) ;
        } else if (window.webkitURL!=undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file) ;
        }
        return url ;
    }
</script>
<script type="text/javascript">
  var subUrl = "";
  let mediaStreamTrack=null; 

  function openMedia() {
    let constraints = {
      video: { width: 500, height: 500,'facingMode': { exact: "environment" }},
      audio: true
    };
    let video = document.getElementById('video');
    let promise = navigator.mediaDevices.getUserMedia(constraints);
    promise.then((mediaStream) => {
      video.srcObject = mediaStream;
      video.play();
    });
  }
  
  function takePhoto() {
    let video = document.getElementById('video');
    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, 500, 500);
    let img = document.getElementById('canvas').toDataURL();
    document.getElementById('imgTag').src=img;
  }
  // close camera
  function closeMedia() {
    // mediaStreamTrack.stop();
    if (video.srcObject) {
        video.srcObject.getTracks().forEach(function (track) { track.stop(); });
    }
  }
$(function (){
    $(".file-3").bind('change',function(){
            subUrl = $(this).val()
            $("#img-1").attr("src", obUrl);
            $(".yulan").hide();
            $(".file-3").parents(".uploader").find(".filename").val(subUrl);
        });
    $(".file-3").each(function(){
            if($(this).val()==""){
                $(this).parents(".uploader").find(".filename").val("Ticket");
            }
        });
    $(".btn-3").click(function(){
        $("#img-1").attr("src", obUrl);
        $(".yulan").hide();
        $(".file-3").parents(".uploader").find(".filename").val(subUrl);
    })
    $(".btn-2").click(function(){
            $(".yulan").hide();
    })

    $(".btn-1").click(function(){
         upload();
        // direct();
        // $(".info").show();
    })

    $(".btn-6").click(function(){
        $("#imgTag").show();
        takePhoto()
        $("#canvas").hide();
        $("#video").hide();
        closeMedia()
    })

    
});
</script>
<script type="text/javascript">
    function setImagePreview() {
        var preview, img_txt, localImag, file_head = document.getElementById("file_head"),
                picture = file_head.value;
        if (!picture.match(/.jpg|.gif|.png|.bmp/i)) return alert("picture format not right"),
                !1;
        if (preview = document.getElementById("preview"), file_head.files && file_head.files[0]) preview.style.display = "block",
                preview.style.width = "63px",
                preview.style.height = "63px",
                preview.src = window.navigator.userAgent.indexOf("Chrome") >= 1 || window.navigator.userAgent.indexOf("Safari") >= 1 ? window.webkitURL.createObjectURL(file_head.files[0]) : window.URL.createObjectURL(file_head.files[0]);
        else {
            file_head.select(),
                    file_head.blur(),
                    img_txt = document.selection.createRange().text,
                    localImag = document.getElementById("localImag"),
                    localImag.style.width = "63px",
                    localImag.style.height = "63px";
            try {
                localImag.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)",
                        localImag.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = img_txt
            } catch(f) {
                return alert("picture format error,pls try again"),
                        !1
            }
            preview.style.display = "none",
            document.selection.empty()
        }
        return document.getElementById("DivUp").style.display = "block",
                !0
    }
</script>
</body>
</html>
